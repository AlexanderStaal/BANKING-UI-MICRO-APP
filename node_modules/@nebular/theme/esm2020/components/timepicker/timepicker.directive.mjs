import { Attribute, Directive, forwardRef, Inject, Input, isDevMode, } from '@angular/core';
import { filter, map, takeUntil } from 'rxjs/operators';
import { fromEvent, merge, Subject } from 'rxjs';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { NbAdjustment, NbPosition, } from '../cdk/overlay/overlay-position';
import { NbTrigger } from '../cdk/overlay/overlay-trigger';
import { NB_DOCUMENT } from '../../theme.options';
import * as i0 from "@angular/core";
import * as i1 from "../cdk/overlay/overlay-position";
import * as i2 from "../cdk/overlay/overlay-trigger";
import * as i3 from "../cdk/overlay/overlay-service";
import * as i4 from "../calendar-kit/services/calendar-time-model.service";
import * as i5 from "../calendar-kit/services/date.service";
/**
 * The `NbTimePickerDirective` is form control that gives you ability to select a time. The timepicker
 * is shown when input receives a `focus` event.
 * ```html
 * <input [nbTimepicker]="timepicker">
 * <nb-timepicker #timepicker></nb-timepicker>
 * ```
 *
 * @stacked-example(Showcase, timepicker/timepicker-showcase.component)
 *
 * ### Installation
 *
 * Import `NbTimepickerModule.forRoot()` to your root module.
 * ```ts
 * @NgModule({
 *   imports: [
 *     // ...
 *     NbTimepickerModule.forRoot(),
 *   ],
 * })
 * export class AppModule { }
 * ```
 * And `NbTimepickerModule` to your feature module.
 * ```ts
 * @NgModule({
 *   imports: [
 *     // ...
 *     NbTimepickerModule,
 *   ],
 * })
 * export class PageModule { }
 *
 * ```
 * <div id="native-parse-issue" class="note note-warning">
 * <div class="note-title">Note</div>
 * <div class="note-body">
 * Timepicker uses native Date object by default, which doesn't support parsing by custom format.
 * According to the ECMAScript specification, the only supported format is a format described by ISO 8061 standard.
 * This standard requires date part to be included in the date string,
 * meaning you have to type a date+time in the input.
 * We highly recommend you to use NbDateFnsDateModule or NbMomentDateModule to be able to support time only strings in
 * the timepicker inputs. These modules use date-fns and moment date libraries, which provide capabilities
 * to parse time only strings.
 * See "Formatting Issue" at
 * <a href="https://akveo.github.io/nebular/docs/components/datepicker/overview#formatting-issue">Date picker docs</a>
 * for installation instructions.
 * </div>
 * </div>
 * <hr>
 *
 * ### Usage
 *
 * To show seconds column along with hours and minutes use `withSeconds` input
 *
 * ```html
 * <input [nbTimepicker]="timepicker">
 * <nb-timepicker #timepicker withSeconds></nb-timepicker>
 * ```
 * @stacked-example(Time picker with seconds, timepicker/timepicker-with-seconds.component)
 *
 * To force timepicker work in 12 hours format, use `twelveHoursFormat` input.
 * By default, timepicker choose 12 or 24 formats based on application locale standards
 *
 * ```html
 * <input [nbTimepicker]="timepicker" twelveHoursFormat>
 * <nb-timepicker #timepicker></nb-timepicker>
 * ```
 *
 * @stacked-example(Twelve hours format showcase, timepicker/timepicker-twelve-hours-format.component)
 *
 * A single column picker with options value as time and minute, so users wonâ€™t be able to pick
 * hours and minutes individually.
 * You can control options minutes offset via `step` input, e.g.: 11:00, 11:20, 11:40...'
 *
 * @stacked-example(Single column, timepicker/timepicker-single-column.component)
 *
 * Timepicker support forms and reactive forms API so you can provide value using `formControl` and `ngModel` directives
 * @stacked-example(Form control, timepicker/timepicker-form-control.component)
 *
 * <input [nbTimepicker]="timepicker" twelveHoursFormat>
 * <nb-timepicker #timepicke [formControl]="formControl"></nb-timepicker>
 *
 * @stacked-example(NgModel, timepicker/timepicker-ng-model.component)
 *
 * <input [nbTimepicker]="timepicker" twelveHoursFormat>
 * <nb-timepicker #timepicke [ngModel]="date"></nb-timepicker>
 *
 * You can provide localized versions of the timepicker text via the `localization` property of the config
 * object passed to the `forRoot` or `forChild` methods of the `NbTimepickerModule`:
 * ```ts
 * @NgModule({
 *   imports: [
 *     // ...
 *     NbTimepickerModule.forRoot({
 *       localization: {
 *         hoursText: 'Hr',
 *         minutesText: 'Min',
 *         secondsText: 'Sec',
 *         ampmText: 'Am/Pm',
 *       }
 *     }),
 *   ],
 * })
 * export class AppModule { }
 * ```
 *
 * @styles
 *
 * timepicker-cell-text-color:
 * timepicker-cell-hover-background-color:
 * timepicker-cell-hover-text-color:
 * timepicker-cell-focus-background-color:
 * timepicker-cell-focus-text-color:
 * timepicker-cell-active-background-color:
 * timepicker-cell-active-text-color:
 * timepicker-cell-text-font-size:
 * timepicker-cell-text-font-family:
 * timepicker-cell-text-line-height:
 * timepicker-cell-text-font-weight:
 * timepicker-cell-height:
 * timepicker-header-cell-text-color:
 * timepicker-header-cell-text-font-size:
 * timepicker-header-cell-text-font-family:
 * timepicker-header-cell-height:
 * timepicker-header-cell-text-line-height:
 * timepicker-header-cell-text-font-weight:
 * timepicker-border-color:
 * timepicker-border-style:
 * timepicker-border-width:
 * timepicker-scrollbar-color:
 * timepicker-scrollbar-background-color:
 * timepicker-scrollbar-width:
 * timepicker-single-column-width:
 * timepicker-multiple-column-width:
 * timepicker-title-height:
 * timepicker-title-padding:
 * timepicker-container-width:
 * timepicker-container-height:
 * */
export class NbTimePickerDirective {
    constructor(document, positionBuilder, hostRef, triggerStrategyBuilder, overlay, cd, calendarTimeModelService, dateService, renderer, placeholder) {
        this.document = document;
        this.positionBuilder = positionBuilder;
        this.hostRef = hostRef;
        this.triggerStrategyBuilder = triggerStrategyBuilder;
        this.overlay = overlay;
        this.cd = cd;
        this.calendarTimeModelService = calendarTimeModelService;
        this.dateService = dateService;
        this.renderer = renderer;
        this.placeholder = placeholder;
        /**
         * Time picker overlay offset.
         * */
        this.overlayOffset = 8;
        this.destroy$ = new Subject();
        this.onChange = () => {
        };
        this.onTouched = () => {
        };
    }
    /**
     * Provides timepicker component.
     * */
    get timepicker() {
        return this._timePickerComponent;
    }
    set timepicker(timePicker) {
        this._timePickerComponent = timePicker;
    }
    /**
     * Returns html input element.
     * @docs-private
     * */
    get input() {
        return this.hostRef.nativeElement;
    }
    /**
     * Determines is timepicker overlay opened.
     * @docs-private
     * */
    get isOpen() {
        return this.overlayRef && this.overlayRef.hasAttached();
    }
    /**
     * Determines is timepicker overlay closed.
     * @docs-private
     * */
    get isClosed() {
        return !this.isOpen;
    }
    /**
     * Returns host input value.
     * @docs-private
     * */
    get inputValue() {
        return this.input.value;
    }
    set inputValue(value) {
        this.input.value = value;
    }
    ngAfterViewInit() {
        this.subscribeOnInputChange();
        if (!this.placeholder) {
            this.renderer.setProperty(this.input, 'placeholder', this.timepicker.timeFormat);
        }
        this.triggerStrategy = this.createTriggerStrategy();
        this.subscribeOnTriggers();
        this.subscribeToBlur();
    }
    show() {
        if (this.isClosed) {
            this.attachToOverlay();
        }
    }
    hide() {
        if (this.isOpen) {
            this.overlayRef.detach();
            this.cd.markForCheck();
        }
    }
    /**
     * Attaches picker to the timepicker portal.
     * @docs-private
     * */
    attachToOverlay() {
        if (!this.overlayRef) {
            this.setupTimepicker();
            this.initOverlay();
        }
        this.overlayRef.attach(this.timepicker.portal);
    }
    setupTimepicker() {
        if (this.dateService.getId() === 'native' && isDevMode()) {
            console.warn('Date.parse does not support parsing time with custom format.' +
                ' See details here https://akveo.github.io/nebular/docs/components/datepicker/overview#native-parse-issue');
        }
        this.timepicker.setHost(this.hostRef);
        if (this.inputValue) {
            const val = this.dateService.getId() === 'native' ? this.parseNativeDateString(this.inputValue) : this.inputValue;
            this.timepicker.date = this.dateService.parse(val, this.timepicker.timeFormat);
        }
        else {
            this.timepicker.date = this.calendarTimeModelService.getResetTime();
        }
    }
    initOverlay() {
        this.positionStrategy = this.createPositionStrategy();
        this.subscribeOnApplyClick();
        this.createOverlay();
    }
    subscribeOnApplyClick() {
        this.timepicker.onSelectTime.pipe(takeUntil(this.destroy$)).subscribe((value) => {
            const time = this.dateService.format(value.time, this.timepicker.timeFormat).toUpperCase();
            this.inputValue = time;
            this.timepicker.date = value.time;
            this.onChange(value.time);
            if (value.save) {
                this.lastInputValue = time;
                this.hide();
            }
        });
    }
    createOverlay() {
        const scrollStrategy = this.createScrollStrategy();
        this.overlayRef = this.overlay.create({ positionStrategy: this.positionStrategy, scrollStrategy });
    }
    subscribeOnTriggers() {
        this.triggerStrategy.show$
            .pipe(filter(() => this.isClosed))
            .subscribe(() => this.show());
        this.triggerStrategy.hide$
            .pipe(filter(() => this.isOpen))
            .subscribe(() => {
            this.inputValue = this.lastInputValue || '';
            this.hide();
        });
    }
    createTriggerStrategy() {
        return this.triggerStrategyBuilder
            .trigger(NbTrigger.FOCUS)
            .host(this.hostRef.nativeElement)
            .container(() => this.getContainer())
            .build();
    }
    createPositionStrategy() {
        return this.positionBuilder
            .connectedTo(this.hostRef)
            .position(NbPosition.BOTTOM)
            .offset(this.overlayOffset)
            .adjustment(NbAdjustment.COUNTERCLOCKWISE);
    }
    getContainer() {
        return this.overlayRef && this.isOpen && {
            location: {
                nativeElement: this.overlayRef.overlayElement,
            },
        };
    }
    createScrollStrategy() {
        return this.overlay.scrollStrategies.block();
    }
    subscribeOnInputChange() {
        fromEvent(this.input, 'input')
            .pipe(map(() => this.inputValue), takeUntil(this.destroy$))
            .subscribe((value) => this.handleInputChange(value));
    }
    subscribeToBlur() {
        merge(this.timepicker.blur, fromEvent(this.input, 'blur').pipe(filter(() => !this.isOpen && this.document.activeElement !== this.input))).pipe(takeUntil(this.destroy$))
            .subscribe(() => this.onTouched());
    }
    /**
     * Parses input value and write if it isn't null.
     * @docs-private
     * */
    handleInputChange(value) {
        if (this.dateService.getId() === 'native') {
            /**
             * Native date service dont parse only time string value,
             * and we adding year mouth and day to convert string to valid date format
             **/
            value = this.parseNativeDateString(value);
        }
        const isValidDate = this.dateService.isValidDateString(value, this.timepicker.timeFormat);
        if (isValidDate) {
            this.lastInputValue = value;
            const date = this.dateService.parse(value, this.timepicker.timeFormat);
            this.onChange(date);
            this.timepicker.date = date;
        }
    }
    updateValue(value) {
        if (value) {
            this.timepicker.date = value;
            const timeString = this.dateService.format(value, this.timepicker.timeFormat).toUpperCase();
            this.inputValue = timeString;
            this.lastInputValue = timeString;
        }
    }
    writeValue(value) {
        this.updateValue(value);
    }
    registerOnChange(fn) {
        this.onChange = fn;
    }
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    parseNativeDateString(value) {
        const date = this.dateService.today();
        const year = this.dateService.getYear(date);
        const month = this.calendarTimeModelService.paddToTwoSymbols(this.dateService.getMonth(date));
        const day = this.calendarTimeModelService.paddToTwoSymbols(this.dateService.getDate(date));
        return `${year}-${month}-${day} ${value}`;
    }
}
NbTimePickerDirective.Éµfac = i0.ÉµÉµngDeclareFactory({ minVersion: "12.0.0", version: "13.0.0", ngImport: i0, type: NbTimePickerDirective, deps: [{ token: NB_DOCUMENT }, { token: i1.NbPositionBuilderService }, { token: i0.ElementRef }, { token: i2.NbTriggerStrategyBuilderService }, { token: i3.NbOverlayService }, { token: i0.ChangeDetectorRef }, { token: i4.NbCalendarTimeModelService }, { token: i5.NbDateService }, { token: i0.Renderer2 }, { token: 'placeholder', attribute: true }], target: i0.ÉµÉµFactoryTarget.Directive });
NbTimePickerDirective.Éµdir = i0.ÉµÉµngDeclareDirective({ minVersion: "12.0.0", version: "13.0.0", type: NbTimePickerDirective, selector: "input[nbTimepicker]", inputs: { timepicker: ["nbTimepicker", "timepicker"], overlayOffset: "overlayOffset" }, providers: [{
            provide: NG_VALUE_ACCESSOR,
            useExisting: forwardRef(() => NbTimePickerDirective),
            multi: true,
        }], ngImport: i0 });
i0.ÉµÉµngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.0.0", ngImport: i0, type: NbTimePickerDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'input[nbTimepicker]',
                    providers: [{
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(() => NbTimePickerDirective),
                            multi: true,
                        }],
                }]
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [NB_DOCUMENT]
                }] }, { type: i1.NbPositionBuilderService }, { type: i0.ElementRef }, { type: i2.NbTriggerStrategyBuilderService }, { type: i3.NbOverlayService }, { type: i0.ChangeDetectorRef }, { type: i4.NbCalendarTimeModelService }, { type: i5.NbDateService }, { type: i0.Renderer2 }, { type: undefined, decorators: [{
                    type: Attribute,
                    args: ['placeholder']
                }] }]; }, propDecorators: { timepicker: [{
                type: Input,
                args: ['nbTimepicker']
            }], overlayOffset: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZXBpY2tlci5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL3RoZW1lL2NvbXBvbmVudHMvdGltZXBpY2tlci90aW1lcGlja2VyLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBRUwsU0FBUyxFQUdULFNBQVMsRUFFVCxVQUFVLEVBQ1YsTUFBTSxFQUNOLEtBQUssRUFDTCxTQUFTLEdBRVYsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2pELE9BQU8sRUFBd0IsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUd6RSxPQUFPLEVBRUwsWUFBWSxFQUNaLFVBQVUsR0FFWCxNQUFNLGlDQUFpQyxDQUFDO0FBRXpDLE9BQU8sRUFBRSxTQUFTLEVBQXNELE1BQU0sZ0NBQWdDLENBQUM7QUFJL0csT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDOzs7Ozs7O0FBRWxEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7S0EwSUs7QUFTTCxNQUFNLE9BQU8scUJBQXFCO0lBb0VoQyxZQUEyQyxRQUFRLEVBQzdCLGVBQXlDLEVBQ3pDLE9BQW1CLEVBQ25CLHNCQUF1RCxFQUN2RCxPQUF5QixFQUN6QixFQUFxQixFQUNyQix3QkFBdUQsRUFDdkQsV0FBNkIsRUFDN0IsUUFBbUIsRUFDTyxXQUFtQjtRQVR4QixhQUFRLEdBQVIs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QUFhO3NHQTdFekIscUJBQXFCLHNJQU5yQixDQUFDO1lBQ1YsT0FBTyxFQUFFLGlCQUFpQjtZQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLHFCQUFxQixDQUFDO1lBQ3BELEtBQUssRUFBRSxJQUFJO1NBQ1osQ0FBQzsyRkFFUyxxQkFBcUI7a0JBUmpDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLHFCQUFxQjtvQkFDL0IsU0FBUyxFQUFFLENBQUM7NEJBQ1YsT0FBTyxFQUFFLGlCQUFpQjs0QkFDMUIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxHQUFHLEVBQUUsc0JBQXNCLENBQUM7NEJBQ3BELEtBQUssRUFBRSxJQUFJO3lCQUNaLENBQUM7aUJBQ0g7OzBCQXFFYyxNQUFNOzJCQUFDLFdBQVc7OzBCQVNsQixTQUFTOzJCQUFDLGFBQWE7NENBeEVoQyxVQUFVO3NCQURiLEtBQUs7dUJBQUMsY0FBYztnQkFhWixhQUFhO3NCQUFyQixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQXR0cmlidXRlLFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50UmVmLFxuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIGZvcndhcmRSZWYsXG4gIEluamVjdCxcbiAgSW5wdXQsXG4gIGlzRGV2TW9kZSxcbiAgUmVuZGVyZXIyLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGZpbHRlciwgbWFwLCB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBmcm9tRXZlbnQsIG1lcmdlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBOYlRpbWVQaWNrZXJDb21wb25lbnQgfSBmcm9tICcuL3RpbWVwaWNrZXIuY29tcG9uZW50JztcbmltcG9ydCB7IE5iT3ZlcmxheVJlZiwgTmJTY3JvbGxTdHJhdGVneSB9IGZyb20gJy4uL2Nkay9vdmVybGF5L21hcHBpbmcnO1xuaW1wb3J0IHtcbiAgTmJBZGp1c3RhYmxlQ29ubmVjdGVkUG9zaXRpb25TdHJhdGVneSxcbiAgTmJBZGp1c3RtZW50LFxuICBOYlBvc2l0aW9uLFxuICBOYlBvc2l0aW9uQnVpbGRlclNlcnZpY2UsXG59IGZyb20gJy4uL2Nkay9vdmVybGF5L292ZXJsYXktcG9zaXRpb24nO1xuaW1wb3J0IHsgTmJPdmVybGF5U2VydmljZSB9IGZyb20gJy4uL2Nkay9vdmVybGF5L292ZXJsYXktc2VydmljZSc7XG5pbXBvcnQgeyBOYlRyaWdnZXIsIE5iVHJpZ2dlclN0cmF0ZWd5LCBOYlRyaWdnZXJTdHJhdGVneUJ1aWxkZXJTZXJ2aWNlIH0gZnJvbSAnLi4vY2RrL292ZXJsYXkvb3ZlcmxheS10cmlnZ2VyJztcbmltcG9ydCB7IE5iU2VsZWN0ZWRUaW1lUGF5bG9hZCB9IGZyb20gJy4vbW9kZWwnO1xuaW1wb3J0IHsgTmJEYXRlU2VydmljZSB9IGZyb20gJy4uL2NhbGVuZGFyLWtpdC9zZXJ2aWNlcy9kYXRlLnNlcnZpY2UnO1xuaW1wb3J0IHsgTmJDYWxlbmRhclRpbWVNb2RlbFNlcnZpY2UgfSBmcm9tICcuLi9jYWxlbmRhci1raXQvc2VydmljZXMvY2FsZW5kYXItdGltZS1tb2RlbC5zZXJ2aWNlJztcbmltcG9ydCB7IE5CX0RPQ1VNRU5UIH0gZnJvbSAnLi4vLi4vdGhlbWUub3B0aW9ucyc7XG5cbi8qKlxuICogVGhlIGBOYlRpbWVQaWNrZXJEaXJlY3RpdmVgIGlzIGZvcm0gY29udHJvbCB0aGF0IGdpdmVzIHlvdSBhYmlsaXR5IHRvIHNlbGVjdCBhIHRpbWUuIFRoZSB0aW1lcGlja2VyXG4gKiBpcyBzaG93biB3aGVuIGlucHV0IHJlY2VpdmVzIGEgYGZvY3VzYCBldmVudC5cbiAqIGBgYGh0bWxcbiAqIDxpbnB1dCBbbmJUaW1lcGlja2VyXT1cInRpbWVwaWNrZXJcIj5cbiAqIDxuYi10aW1lcGlja2VyICN0aW1lcGlja2VyPjwvbmItdGltZXBpY2tlcj5cbiAqIGBgYFxuICpcbiAqIEBzdGFja2VkLWV4YW1wbGUoU2hvd2Nhc2UsIHRpbWVwaWNrZXIvdGltZXBpY2tlci1zaG93Y2FzZS5jb21wb25lbnQpXG4gKlxuICogIyMjIEluc3RhbGxhdGlvblxuICpcbiAqIEltcG9ydCBgTmJUaW1lcGlja2VyTW9kdWxlLmZvclJvb3QoKWAgdG8geW91ciByb290IG1vZHVsZS5cbiAqIGBgYHRzXG4gKiBATmdNb2R1bGUoe1xuICogICBpbXBvcnRzOiBbXG4gKiAgICAgLy8gLi4uXG4gKiAgICAgTmJUaW1lcGlja2VyTW9kdWxlLmZvclJvb3QoKSxcbiAqICAgXSxcbiAqIH0pXG4gKiBleHBvcnQgY2xhc3MgQXBwTW9kdWxlIHsgfVxuICogYGBgXG4gKiBBbmQgYE5iVGltZXBpY2tlck1vZHVsZWAgdG8geW91ciBmZWF0dXJlIG1vZHVsZS5cbiAqIGBgYHRzXG4gKiBATmdNb2R1bGUoe1xuICogICBpbXBvcnRzOiBbXG4gKiAgICAgLy8gLi4uXG4gKiAgICAgTmJUaW1lcGlja2VyTW9kdWxlLFxuICogICBdLFxuICogfSlcbiAqIGV4cG9ydCBjbGFzcyBQYWdlTW9kdWxlIHsgfVxuICpcbiAqIGBgYFxuICogPGRpdiBpZD1cIm5hdGl2ZS1wYXJzZS1pc3N1ZVwiIGNsYXNzPVwibm90ZSBub3RlLXdhcm5pbmdcIj5cbiAqIDxkaXYgY2xhc3M9XCJub3RlLXRpdGxlXCI+Tm90ZTwvZGl2PlxuICogPGRpdiBjbGFzcz1cIm5vdGUtYm9keVwiPlxuICogVGltZXBpY2tlciB1c2VzIG5hdGl2ZSBEYXRlIG9iamVjdCBieSBkZWZhdWx0LCB3aGljaCBkb2Vzbid0IHN1cHBvcnQgcGFyc2luZyBieSBjdXN0b20gZm9ybWF0LlxuICogQWNjb3JkaW5nIHRvIHRoZSBFQ01BU2NyaXB0IHNwZWNpZmljYXRpb24sIHRoZSBvbmx5IHN1cHBvcnRlZCBmb3JtYXQgaXMgYSBmb3JtYXQgZGVzY3JpYmVkIGJ5IElTTyA4MDYxIHN0YW5kYXJkLlxuICogVGhpcyBzdGFuZGFyZCByZXF1aXJlcyBkYXRlIHBhcnQgdG8gYmUgaW5jbHVkZWQgaW4gdGhlIGRhdGUgc3RyaW5nLFxuICogbWVhbmluZyB5b3UgaGF2ZSB0byB0eXBlIGEgZGF0ZSt0aW1lIGluIHRoZSBpbnB1dC5cbiAqIFdlIGhpZ2hseSByZWNvbW1lbmQgeW91IHRvIHVzZSBOYkRhdGVGbnNEYXRlTW9kdWxlIG9yIE5iTW9tZW50RGF0ZU1vZHVsZSB0byBiZSBhYmxlIHRvIHN1cHBvcnQgdGltZSBvbmx5IHN0cmluZ3MgaW5cbiAqIHRoZSB0aW1lcGlja2VyIGlucHV0cy4gVGhlc2UgbW9kdWxlcyB1c2UgZGF0ZS1mbnMgYW5kIG1vbWVudCBkYXRlIGxpYnJhcmllcywgd2hpY2ggcHJvdmlkZSBjYXBhYmlsaXRpZXNcbiAqIHRvIHBhcnNlIHRpbWUgb25seSBzdHJpbmdzLlxuICogU2VlIFwiRm9ybWF0dGluZyBJc3N1ZVwiIGF0XG4gKiA8YSBocmVmPVwiaHR0cHM6Ly9ha3Zlby5naXRodWIuaW8vbmVidWxhci9kb2NzL2NvbXBvbmVudHMvZGF0ZXBpY2tlci9vdmVydmlldyNmb3JtYXR0aW5nLWlzc3VlXCI+RGF0ZSBwaWNrZXIgZG9jczwvYT5cbiAqIGZvciBpbnN0YWxsYXRpb24gaW5zdHJ1Y3Rpb25zLlxuICogPC9kaXY+XG4gKiA8L2Rpdj5cbiAqIDxocj5cbiAqXG4gKiAjIyMgVXNhZ2VcbiAqXG4gKiBUbyBzaG93IHNlY29uZHMgY29sdW1uIGFsb25nIHdpdGggaG91cnMgYW5kIG1pbnV0ZXMgdXNlIGB3aXRoU2Vjb25kc2AgaW5wdXRcbiAqXG4gKiBgYGBodG1sXG4gKiA8aW5wdXQgW25iVGltZXBpY2tlcl09XCJ0aW1lcGlja2VyXCI+XG4gKiA8bmItdGltZXBpY2tlciAjdGltZXBpY2tlciB3aXRoU2Vjb25kcz48L25iLXRpbWVwaWNrZXI+XG4gKiBgYGBcbiAqIEBzdGFja2VkLWV4YW1wbGUoVGltZSBwaWNrZXIgd2l0aCBzZWNvbmRzLCB0aW1lcGlja2VyL3RpbWVwaWNrZXItd2l0aC1zZWNvbmRzLmNvbXBvbmVudClcbiAqXG4gKiBUbyBmb3JjZSB0aW1lcGlja2VyIHdvcmsgaW4gMTIgaG91cnMgZm9ybWF0LCB1c2UgYHR3ZWx2ZUhvdXJzRm9ybWF0YCBpbnB1dC5cbiAqIEJ5IGRlZmF1bHQsIHRpbWVwaWNrZXIgY2hvb3NlIDEyIG9yIDI0IGZvcm1hdHMgYmFzZWQgb24gYXBwbGljYXRpb24gbG9jYWxlIHN0YW5kYXJkc1xuICpcbiAqIGBgYGh0bWxcbiAqIDxpbnB1dCBbbmJUaW1lcGlja2VyXT1cInRpbWVwaWNrZXJcIiB0d2VsdmVIb3Vyc0Zvcm1hdD5cbiAqIDxuYi10aW1lcGlja2VyICN0aW1lcGlja2VyPjwvbmItdGltZXBpY2tlcj5cbiAqIGBgYFxuICpcbiAqIEBzdGFja2VkLWV4YW1wbGUoVHdlbHZlIGhvdXJzIGZvcm1hdCBzaG93Y2FzZSwgdGltZXBpY2tlci90aW1lcGlja2VyLXR3ZWx2ZS1ob3Vycy1mb3JtYXQuY29tcG9uZW50KVxuICpcbiAqIEEgc2luZ2xlIGNvbHVtbiBwaWNrZXIgd2l0aCBvcHRpb25zIHZhbHVlIGFzIHRpbWUgYW5kIG1pbnV0ZSwgc28gdXNlcnMgd29u4oCZdCBiZSBhYmxlIHRvIHBpY2tcbiAqIGhvdXJzIGFuZCBtaW51dGVzIGluZGl2aWR1YWxseS5cbiAqIFlvdSBjYW4gY29udHJvbCBvcHRpb25zIG1pbnV0ZXMgb2Zmc2V0IHZpYSBgc3RlcGAgaW5wdXQsIGUuZy46IDExOjAwLCAxMToyMCwgMTE6NDAuLi4nXG4gKlxuICogQHN0YWNrZWQtZXhhbXBsZShTaW5nbGUgY29sdW1uLCB0aW1lcGlja2VyL3RpbWVwaWNrZXItc2luZ2xlLWNvbHVtbi5jb21wb25lbnQpXG4gKlxuICogVGltZXBpY2tlciBzdXBwb3J0IGZvcm1zIGFuZCByZWFjdGl2ZSBmb3JtcyBBUEkgc28geW91IGNhbiBwcm92aWRlIHZhbHVlIHVzaW5nIGBmb3JtQ29udHJvbGAgYW5kIGBuZ01vZGVsYCBkaXJlY3RpdmVzXG4gKiBAc3RhY2tlZC1leGFtcGxlKEZvcm0gY29udHJvbCwgdGltZXBpY2tlci90aW1lcGlja2VyLWZvcm0tY29udHJvbC5jb21wb25lbnQpXG4gKlxuICogPGlucHV0IFtuYlRpbWVwaWNrZXJdPVwidGltZXBpY2tlclwiIHR3ZWx2ZUhvdXJzRm9ybWF0PlxuICogPG5iLXRpbWVwaWNrZXIgI3RpbWVwaWNrZSBbZm9ybUNvbnRyb2xdPVwiZm9ybUNvbnRyb2xcIj48L25iLXRpbWVwaWNrZXI+XG4gKlxuICogQHN0YWNrZWQtZXhhbXBsZShOZ01vZGVsLCB0aW1lcGlja2VyL3RpbWVwaWNrZXItbmctbW9kZWwuY29tcG9uZW50KVxuICpcbiAqIDxpbnB1dCBbbmJUaW1lcGlja2VyXT1cInRpbWVwaWNrZXJcIiB0d2VsdmVIb3Vyc0Zvcm1hdD5cbiAqIDxuYi10aW1lcGlja2VyICN0aW1lcGlja2UgW25nTW9kZWxdPVwiZGF0ZVwiPjwvbmItdGltZXBpY2tlcj5cbiAqXG4gKiBZb3UgY2FuIHByb3ZpZGUgbG9jYWxpemVkIHZlcnNpb25zIG9mIHRoZSB0aW1lcGlja2VyIHRleHQgdmlhIHRoZSBgbG9jYWxpemF0aW9uYCBwcm9wZXJ0eSBvZiB0aGUgY29uZmlnXG4gKiBvYmplY3QgcGFzc2VkIHRvIHRoZSBgZm9yUm9vdGAgb3IgYGZvckNoaWxkYCBtZXRob2RzIG9mIHRoZSBgTmJUaW1lcGlja2VyTW9kdWxlYDpcbiAqIGBgYHRzXG4gKiBATmdNb2R1bGUoe1xuICogICBpbXBvcnRzOiBbXG4gKiAgICAgLy8gLi4uXG4gKiAgICAgTmJUaW1lcGlja2VyTW9kdWxlLmZvclJvb3Qoe1xuICogICAgICAgbG9jYWxpemF0aW9uOiB7XG4gKiAgICAgICAgIGhvdXJzVGV4dDogJ0hyJyxcbiAqICAgICAgICAgbWludXRlc1RleHQ6ICdNaW4nLFxuICogICAgICAgICBzZWNvbmRzVGV4dDogJ1NlYycsXG4gKiAgICAgICAgIGFtcG1UZXh0OiAnQW0vUG0nLFxuICogICAgICAgfVxuICogICAgIH0pLFxuICogICBdLFxuICogfSlcbiAqIGV4cG9ydCBjbGFzcyBBcHBNb2R1bGUgeyB9XG4gKiBgYGBcbiAqXG4gKiBAc3R5bGVzXG4gKlxuICogdGltZXBpY2tlci1jZWxsLXRleHQtY29sb3I6XG4gKiB0aW1lcGlja2VyLWNlbGwtaG92ZXItYmFja2dyb3VuZC1jb2xvcjpcbiAqIHRpbWVwaWNrZXItY2VsbC1ob3Zlci10ZXh0LWNvbG9yOlxuICogdGltZXBpY2tlci1jZWxsLWZvY3VzLWJhY2tncm91bmQtY29sb3I6XG4gKiB0aW1lcGlja2VyLWNlbGwtZm9jdXMtdGV4dC1jb2xvcjpcbiAqIHRpbWVwaWNrZXItY2VsbC1hY3RpdmUtYmFja2dyb3VuZC1jb2xvcjpcbiAqIHRpbWVwaWNrZXItY2VsbC1hY3RpdmUtdGV4dC1jb2xvcjpcbiAqIHRpbWVwaWNrZXItY2VsbC10ZXh0LWZvbnQtc2l6ZTpcbiAqIHRpbWVwaWNrZXItY2VsbC10ZXh0LWZvbnQtZmFtaWx5OlxuICogdGltZXBpY2tlci1jZWxsLXRleHQtbGluZS1oZWlnaHQ6XG4gKiB0aW1lcGlja2VyLWNlbGwtdGV4dC1mb250LXdlaWdodDpcbiAqIHRpbWVwaWNrZXItY2VsbC1oZWlnaHQ6XG4gKiB0aW1lcGlja2VyLWhlYWRlci1jZWxsLXRleHQtY29sb3I6XG4gKiB0aW1lcGlja2VyLWhlYWRlci1jZWxsLXRleHQtZm9udC1zaXplOlxuICogdGltZXBpY2tlci1oZWFkZXItY2VsbC10ZXh0LWZvbnQtZmFtaWx5OlxuICogdGltZXBpY2tlci1oZWFkZXItY2VsbC1oZWlnaHQ6XG4gKiB0aW1lcGlja2VyLWhlYWRlci1jZWxsLXRleHQtbGluZS1oZWlnaHQ6XG4gKiB0aW1lcGlja2VyLWhlYWRlci1jZWxsLXRleHQtZm9udC13ZWlnaHQ6XG4gKiB0aW1lcGlja2VyLWJvcmRlci1jb2xvcjpcbiAqIHRpbWVwaWNrZXItYm9yZGVyLXN0eWxlOlxuICogdGltZXBpY2tlci1ib3JkZXItd2lkdGg6XG4gKiB0aW1lcGlja2VyLXNjcm9sbGJhci1jb2xvcjpcbiAqIHRpbWVwaWNrZXItc2Nyb2xsYmFyLWJhY2tncm91bmQtY29sb3I6XG4gKiB0aW1lcGlja2VyLXNjcm9sbGJhci13aWR0aDpcbiAqIHRpbWVwaWNrZXItc2luZ2xlLWNvbHVtbi13aWR0aDpcbiAqIHRpbWVwaWNrZXItbXVsdGlwbGUtY29sdW1uLXdpZHRoOlxuICogdGltZXBpY2tlci10aXRsZS1oZWlnaHQ6XG4gKiB0aW1lcGlja2VyLXRpdGxlLXBhZGRpbmc6XG4gKiB0aW1lcGlja2VyLWNvbnRhaW5lci13aWR0aDpcbiAqIHRpbWVwaWNrZXItY29udGFpbmVyLWhlaWdodDpcbiAqICovXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdpbnB1dFtuYlRpbWVwaWNrZXJdJyxcbiAgcHJvdmlkZXJzOiBbe1xuICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IE5iVGltZVBpY2tlckRpcmVjdGl2ZSksXG4gICAgbXVsdGk6IHRydWUsXG4gIH1dLFxufSlcbmV4cG9ydCBjbGFzcyBOYlRpbWVQaWNrZXJEaXJlY3RpdmU8RD4gaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBDb250cm9sVmFsdWVBY2Nlc3NvciB7XG4gIC8qKlxuICAgKiBQcm92aWRlcyB0aW1lcGlja2VyIGNvbXBvbmVudC5cbiAgICogKi9cbiAgQElucHV0KCduYlRpbWVwaWNrZXInKVxuICBnZXQgdGltZXBpY2tlcigpOiBOYlRpbWVQaWNrZXJDb21wb25lbnQ8RD4ge1xuICAgIHJldHVybiB0aGlzLl90aW1lUGlja2VyQ29tcG9uZW50O1xuICB9XG5cbiAgc2V0IHRpbWVwaWNrZXIodGltZVBpY2tlcjogTmJUaW1lUGlja2VyQ29tcG9uZW50PEQ+KSB7XG4gICAgdGhpcy5fdGltZVBpY2tlckNvbXBvbmVudCA9IHRpbWVQaWNrZXI7XG4gIH1cbiAgcHJvdGVjdGVkIF90aW1lUGlja2VyQ29tcG9uZW50OiBOYlRpbWVQaWNrZXJDb21wb25lbnQ8RD47XG5cbiAgLyoqXG4gICAqIFRpbWUgcGlja2VyIG92ZXJsYXkgb2Zmc2V0LlxuICAgKiAqL1xuICBASW5wdXQoKSBvdmVybGF5T2Zmc2V0ID0gODtcblxuXG4gIC8qKlxuICAgKiBTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgbGF0ZXN0IHNlbGVjdGVkIGRhdGUuXG4gICAqIFVwZGF0ZWQgd2hlbiB2YWx1ZSBpcyB1cGRhdGVkIHByb2dyYW1tYXRpY2FsbHkgKHdyaXRlVmFsdWUpLCB2aWEgdGltZXBpY2tlciAoc3Vic2NyaWJlT25BcHBseUNsaWNrKVxuICAgKiBvciB2aWEgaW5wdXQgZmllbGQgKGhhbmRsZUlucHV0Q2hhbmdlKVxuICAgKiBAZG9jcy1wcml2YXRlXG4gICAqL1xuICBwcm90ZWN0ZWQgbGFzdElucHV0VmFsdWU6IHN0cmluZztcbiAgLyoqXG4gICAqIFBvc2l0aW9uaW5nIHN0cmF0ZWd5IHVzZWQgYnkgb3ZlcmxheS5cbiAgICogQGRvY3MtcHJpdmF0ZVxuICAgKiAqL1xuICBwcm90ZWN0ZWQgcG9zaXRpb25TdHJhdGVneTogTmJBZGp1c3RhYmxlQ29ubmVjdGVkUG9zaXRpb25TdHJhdGVneTtcbiAgcHJvdGVjdGVkIG92ZXJsYXlSZWY6IE5iT3ZlcmxheVJlZjtcbiAgcHJvdGVjdGVkIGRlc3Ryb3kkOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcbiAgcHJvdGVjdGVkIG9uQ2hhbmdlOiAodmFsdWU6IEQpID0+IHZvaWQgPSAoKSA9PiB7XG4gIH07XG4gIHByb3RlY3RlZCBvblRvdWNoZWQgPSAoKSA9PiB7XG4gIH07XG4gIC8qKlxuICAgKiBUcmlnZ2VyIHN0cmF0ZWd5IHVzZWQgYnkgb3ZlcmxheS5cbiAgICogQGRvY3MtcHJpdmF0ZVxuICAgKiAqL1xuICBwcm90ZWN0ZWQgdHJpZ2dlclN0cmF0ZWd5OiBOYlRyaWdnZXJTdHJhdGVneTtcblxuICAvKipcbiAgICogUmV0dXJucyBodG1sIGlucHV0IGVsZW1lbnQuXG4gICAqIEBkb2NzLXByaXZhdGVcbiAgICogKi9cbiAgZ2V0IGlucHV0KCk6IEhUTUxJbnB1dEVsZW1lbnQge1xuICAgIHJldHVybiB0aGlzLmhvc3RSZWYubmF0aXZlRWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmVzIGlzIHRpbWVwaWNrZXIgb3ZlcmxheSBvcGVuZWQuXG4gICAqIEBkb2NzLXByaXZhdGVcbiAgICogKi9cbiAgZ2V0IGlzT3BlbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5vdmVybGF5UmVmICYmIHRoaXMub3ZlcmxheVJlZi5oYXNBdHRhY2hlZCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVybWluZXMgaXMgdGltZXBpY2tlciBvdmVybGF5IGNsb3NlZC5cbiAgICogQGRvY3MtcHJpdmF0ZVxuICAgKiAqL1xuICBnZXQgaXNDbG9zZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLmlzT3BlbjtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKEBJbmplY3QoTkJfRE9DVU1FTlQpIHByb3RlY3RlZCBkb2N1bWVudCxcbiAgICAgICAgICAgICAgcHJvdGVjdGVkIHBvc2l0aW9uQnVpbGRlcjogTmJQb3NpdGlvbkJ1aWxkZXJTZXJ2aWNlLFxuICAgICAgICAgICAgICBwcm90ZWN0ZWQgaG9zdFJlZjogRWxlbWVudFJlZixcbiAgICAgICAgICAgICAgcHJvdGVjdGVkIHRyaWdnZXJTdHJhdGVneUJ1aWxkZXI6IE5iVHJpZ2dlclN0cmF0ZWd5QnVpbGRlclNlcnZpY2UsXG4gICAgICAgICAgICAgIHByb3RlY3RlZCBvdmVybGF5OiBOYk92ZXJsYXlTZXJ2aWNlLFxuICAgICAgICAgICAgICBwcm90ZWN0ZWQgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICAgICAgICBwcm90ZWN0ZWQgY2FsZW5kYXJUaW1lTW9kZWxTZXJ2aWNlOiBOYkNhbGVuZGFyVGltZU1vZGVsU2VydmljZTxEPixcbiAgICAgICAgICAgICAgcHJvdGVjdGVkIGRhdGVTZXJ2aWNlOiBOYkRhdGVTZXJ2aWNlPEQ+LFxuICAgICAgICAgICAgICBwcm90ZWN0ZWQgcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICAgICAgICAgICAgQEF0dHJpYnV0ZSgncGxhY2Vob2xkZXInKSBwcm90ZWN0ZWQgcGxhY2Vob2xkZXI6IHN0cmluZykge1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgaG9zdCBpbnB1dCB2YWx1ZS5cbiAgICogQGRvY3MtcHJpdmF0ZVxuICAgKiAqL1xuICBnZXQgaW5wdXRWYWx1ZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmlucHV0LnZhbHVlO1xuICB9XG5cbiAgc2V0IGlucHV0VmFsdWUodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMuaW5wdXQudmFsdWUgPSB2YWx1ZTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLnN1YnNjcmliZU9uSW5wdXRDaGFuZ2UoKTtcblxuICAgIGlmICghdGhpcy5wbGFjZWhvbGRlcikge1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRQcm9wZXJ0eSh0aGlzLmlucHV0LCAncGxhY2Vob2xkZXInLCB0aGlzLnRpbWVwaWNrZXIudGltZUZvcm1hdCk7XG4gICAgfVxuICAgIHRoaXMudHJpZ2dlclN0cmF0ZWd5ID0gdGhpcy5jcmVhdGVUcmlnZ2VyU3RyYXRlZ3koKTtcbiAgICB0aGlzLnN1YnNjcmliZU9uVHJpZ2dlcnMoKTtcbiAgICB0aGlzLnN1YnNjcmliZVRvQmx1cigpO1xuICB9XG5cbiAgc2hvdygpIHtcbiAgICBpZiAodGhpcy5pc0Nsb3NlZCkge1xuICAgICAgdGhpcy5hdHRhY2hUb092ZXJsYXkoKTtcbiAgICB9XG4gIH1cblxuICBoaWRlKCkge1xuICAgIGlmICh0aGlzLmlzT3Blbikge1xuICAgICAgdGhpcy5vdmVybGF5UmVmLmRldGFjaCgpO1xuICAgICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQXR0YWNoZXMgcGlja2VyIHRvIHRoZSB0aW1lcGlja2VyIHBvcnRhbC5cbiAgICogQGRvY3MtcHJpdmF0ZVxuICAgKiAqL1xuICBwcm90ZWN0ZWQgYXR0YWNoVG9PdmVybGF5KCkge1xuICAgIGlmICghdGhpcy5vdmVybGF5UmVmKSB7XG4gICAgICB0aGlzLnNldHVwVGltZXBpY2tlcigpO1xuICAgICAgdGhpcy5pbml0T3ZlcmxheSgpO1xuICAgIH1cbiAgICB0aGlzLm92ZXJsYXlSZWYuYXR0YWNoKHRoaXMudGltZXBpY2tlci5wb3J0YWwpO1xuICB9XG5cbiAgc2V0dXBUaW1lcGlja2VyKCkge1xuICAgIGlmICh0aGlzLmRhdGVTZXJ2aWNlLmdldElkKCkgPT09ICduYXRpdmUnICYmIGlzRGV2TW9kZSgpKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0RhdGUucGFyc2UgZG9lcyBub3Qgc3VwcG9ydCBwYXJzaW5nIHRpbWUgd2l0aCBjdXN0b20gZm9ybWF0LicgK1xuICAgICAgICAnIFNlZSBkZXRhaWxzIGhlcmUgaHR0cHM6Ly9ha3Zlby5naXRodWIuaW8vbmVidWxhci9kb2NzL2NvbXBvbmVudHMvZGF0ZXBpY2tlci9vdmVydmlldyNuYXRpdmUtcGFyc2UtaXNzdWUnKVxuICAgIH1cbiAgICB0aGlzLnRpbWVwaWNrZXIuc2V0SG9zdCh0aGlzLmhvc3RSZWYpO1xuICAgIGlmICh0aGlzLmlucHV0VmFsdWUpIHtcbiAgICAgIGNvbnN0IHZhbCA9IHRoaXMuZGF0ZVNlcnZpY2UuZ2V0SWQoKSA9PT0gJ25hdGl2ZScgPyB0aGlzLnBhcnNlTmF0aXZlRGF0ZVN0cmluZyh0aGlzLmlucHV0VmFsdWUpIDogdGhpcy5pbnB1dFZhbHVlO1xuICAgICAgdGhpcy50aW1lcGlja2VyLmRhdGUgPSB0aGlzLmRhdGVTZXJ2aWNlLnBhcnNlKHZhbCwgdGhpcy50aW1lcGlja2VyLnRpbWVGb3JtYXQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnRpbWVwaWNrZXIuZGF0ZSA9IHRoaXMuY2FsZW5kYXJUaW1lTW9kZWxTZXJ2aWNlLmdldFJlc2V0VGltZSgpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBpbml0T3ZlcmxheSgpIHtcbiAgICB0aGlzLnBvc2l0aW9uU3RyYXRlZ3kgPSB0aGlzLmNyZWF0ZVBvc2l0aW9uU3RyYXRlZ3koKTtcbiAgICB0aGlzLnN1YnNjcmliZU9uQXBwbHlDbGljaygpO1xuICAgIHRoaXMuY3JlYXRlT3ZlcmxheSgpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHN1YnNjcmliZU9uQXBwbHlDbGljaygpIHtcbiAgICB0aGlzLnRpbWVwaWNrZXIub25TZWxlY3RUaW1lLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoKHZhbHVlOiBOYlNlbGVjdGVkVGltZVBheWxvYWQ8RD4pID0+IHtcbiAgICAgIGNvbnN0IHRpbWUgPSB0aGlzLmRhdGVTZXJ2aWNlLmZvcm1hdCh2YWx1ZS50aW1lLCB0aGlzLnRpbWVwaWNrZXIudGltZUZvcm1hdCkudG9VcHBlckNhc2UoKTtcbiAgICAgIHRoaXMuaW5wdXRWYWx1ZSA9IHRpbWU7XG4gICAgICB0aGlzLnRpbWVwaWNrZXIuZGF0ZSA9IHZhbHVlLnRpbWU7XG4gICAgICB0aGlzLm9uQ2hhbmdlKHZhbHVlLnRpbWUpO1xuICAgICAgaWYgKHZhbHVlLnNhdmUpIHtcbiAgICAgICAgdGhpcy5sYXN0SW5wdXRWYWx1ZSA9IHRpbWU7XG4gICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZU92ZXJsYXkoKSB7XG4gICAgY29uc3Qgc2Nyb2xsU3RyYXRlZ3kgPSB0aGlzLmNyZWF0ZVNjcm9sbFN0cmF0ZWd5KCk7XG4gICAgdGhpcy5vdmVybGF5UmVmID0gdGhpcy5vdmVybGF5LmNyZWF0ZShcbiAgICAgIHtwb3NpdGlvblN0cmF0ZWd5OiB0aGlzLnBvc2l0aW9uU3RyYXRlZ3ksIHNjcm9sbFN0cmF0ZWd5fSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgc3Vic2NyaWJlT25UcmlnZ2VycygpIHtcbiAgICB0aGlzLnRyaWdnZXJTdHJhdGVneS5zaG93JFxuICAgIC5waXBlKGZpbHRlcigoKSA9PiB0aGlzLmlzQ2xvc2VkKSlcbiAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMuc2hvdygpKTtcblxuICAgIHRoaXMudHJpZ2dlclN0cmF0ZWd5LmhpZGUkXG4gICAgLnBpcGUoZmlsdGVyKCgpID0+IHRoaXMuaXNPcGVuKSlcbiAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHRoaXMuaW5wdXRWYWx1ZSA9IHRoaXMubGFzdElucHV0VmFsdWUgfHwgJyc7XG4gICAgICB0aGlzLmhpZGUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjcmVhdGVUcmlnZ2VyU3RyYXRlZ3koKTogTmJUcmlnZ2VyU3RyYXRlZ3kge1xuICAgIHJldHVybiB0aGlzLnRyaWdnZXJTdHJhdGVneUJ1aWxkZXJcbiAgICAudHJpZ2dlcihOYlRyaWdnZXIuRk9DVVMpXG4gICAgLmhvc3QodGhpcy5ob3N0UmVmLm5hdGl2ZUVsZW1lbnQpXG4gICAgLmNvbnRhaW5lcigoKSA9PiB0aGlzLmdldENvbnRhaW5lcigpKVxuICAgIC5idWlsZCgpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZVBvc2l0aW9uU3RyYXRlZ3koKTogTmJBZGp1c3RhYmxlQ29ubmVjdGVkUG9zaXRpb25TdHJhdGVneSB7XG4gICAgcmV0dXJuIHRoaXMucG9zaXRpb25CdWlsZGVyXG4gICAgLmNvbm5lY3RlZFRvKHRoaXMuaG9zdFJlZilcbiAgICAucG9zaXRpb24oTmJQb3NpdGlvbi5CT1RUT00pXG4gICAgLm9mZnNldCh0aGlzLm92ZXJsYXlPZmZzZXQpXG4gICAgLmFkanVzdG1lbnQoTmJBZGp1c3RtZW50LkNPVU5URVJDTE9DS1dJU0UpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldENvbnRhaW5lcigpIHtcbiAgICByZXR1cm4gdGhpcy5vdmVybGF5UmVmICYmIHRoaXMuaXNPcGVuICYmIDxDb21wb25lbnRSZWY8YW55Pj57XG4gICAgICBsb2NhdGlvbjoge1xuICAgICAgICBuYXRpdmVFbGVtZW50OiB0aGlzLm92ZXJsYXlSZWYub3ZlcmxheUVsZW1lbnQsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBwcm90ZWN0ZWQgY3JlYXRlU2Nyb2xsU3RyYXRlZ3koKTogTmJTY3JvbGxTdHJhdGVneSB7XG4gICAgcmV0dXJuIHRoaXMub3ZlcmxheS5zY3JvbGxTdHJhdGVnaWVzLmJsb2NrKCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgc3Vic2NyaWJlT25JbnB1dENoYW5nZSgpIHtcbiAgICBmcm9tRXZlbnQodGhpcy5pbnB1dCwgJ2lucHV0JylcbiAgICAucGlwZShcbiAgICAgIG1hcCgoKSA9PiB0aGlzLmlucHV0VmFsdWUpLFxuICAgICAgdGFrZVVudGlsKHRoaXMuZGVzdHJveSQpLFxuICAgIClcbiAgICAuc3Vic2NyaWJlKCh2YWx1ZTogc3RyaW5nKSA9PiB0aGlzLmhhbmRsZUlucHV0Q2hhbmdlKHZhbHVlKSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgc3Vic2NyaWJlVG9CbHVyKCkge1xuICAgIG1lcmdlKFxuICAgICAgdGhpcy50aW1lcGlja2VyLmJsdXIsXG4gICAgICBmcm9tRXZlbnQodGhpcy5pbnB1dCwgJ2JsdXInKS5waXBlKFxuICAgICAgICBmaWx0ZXIoKCkgPT4gIXRoaXMuaXNPcGVuICYmIHRoaXMuZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAhPT0gdGhpcy5pbnB1dCksXG4gICAgICApLFxuICAgICkucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpXG4gICAgLnN1YnNjcmliZSgoKSA9PiB0aGlzLm9uVG91Y2hlZCgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZXMgaW5wdXQgdmFsdWUgYW5kIHdyaXRlIGlmIGl0IGlzbid0IG51bGwuXG4gICAqIEBkb2NzLXByaXZhdGVcbiAgICogKi9cbiAgcHJvdGVjdGVkIGhhbmRsZUlucHV0Q2hhbmdlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5kYXRlU2VydmljZS5nZXRJZCgpID09PSAnbmF0aXZlJykge1xuICAgICAgLyoqXG4gICAgICAgKiBOYXRpdmUgZGF0ZSBzZXJ2aWNlIGRvbnQgcGFyc2Ugb25seSB0aW1lIHN0cmluZyB2YWx1ZSxcbiAgICAgICAqIGFuZCB3ZSBhZGRpbmcgeWVhciBtb3V0aCBhbmQgZGF5IHRvIGNvbnZlcnQgc3RyaW5nIHRvIHZhbGlkIGRhdGUgZm9ybWF0XG4gICAgICAgKiovXG4gICAgICB2YWx1ZSA9IHRoaXMucGFyc2VOYXRpdmVEYXRlU3RyaW5nKHZhbHVlKTtcbiAgICB9XG5cbiAgICBjb25zdCBpc1ZhbGlkRGF0ZTogYm9vbGVhbiA9IHRoaXMuZGF0ZVNlcnZpY2UuaXNWYWxpZERhdGVTdHJpbmcodmFsdWUsIHRoaXMudGltZXBpY2tlci50aW1lRm9ybWF0KTtcbiAgICBpZiAoaXNWYWxpZERhdGUpIHtcbiAgICAgIHRoaXMubGFzdElucHV0VmFsdWUgPSB2YWx1ZTtcblxuICAgICAgY29uc3QgZGF0ZSA9IHRoaXMuZGF0ZVNlcnZpY2UucGFyc2UodmFsdWUsIHRoaXMudGltZXBpY2tlci50aW1lRm9ybWF0KTtcbiAgICAgIHRoaXMub25DaGFuZ2UoZGF0ZSk7XG4gICAgICB0aGlzLnRpbWVwaWNrZXIuZGF0ZSA9IGRhdGU7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIHVwZGF0ZVZhbHVlKHZhbHVlOiBEKSB7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICB0aGlzLnRpbWVwaWNrZXIuZGF0ZSA9IHZhbHVlO1xuXG4gICAgICBjb25zdCB0aW1lU3RyaW5nID0gdGhpcy5kYXRlU2VydmljZS5mb3JtYXQodmFsdWUsIHRoaXMudGltZXBpY2tlci50aW1lRm9ybWF0KS50b1VwcGVyQ2FzZSgpO1xuICAgICAgdGhpcy5pbnB1dFZhbHVlID0gdGltZVN0cmluZztcbiAgICAgIHRoaXMubGFzdElucHV0VmFsdWUgPSB0aW1lU3RyaW5nO1xuICAgIH1cbiAgfVxuXG4gIHdyaXRlVmFsdWUodmFsdWU6IEQpOiB2b2lkIHtcbiAgICB0aGlzLnVwZGF0ZVZhbHVlKHZhbHVlKTtcbiAgfVxuXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46ICh2YWx1ZTogYW55KSA9PiB7fSk6IHZvaWQge1xuICAgIHRoaXMub25DaGFuZ2UgPSBmbjtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLm9uVG91Y2hlZCA9IGZuO1xuICB9XG5cbiAgcHJvdGVjdGVkIHBhcnNlTmF0aXZlRGF0ZVN0cmluZyh2YWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBkYXRlID0gdGhpcy5kYXRlU2VydmljZS50b2RheSgpO1xuICAgIGNvbnN0IHllYXIgPSB0aGlzLmRhdGVTZXJ2aWNlLmdldFllYXIoZGF0ZSk7XG4gICAgY29uc3QgbW9udGggPSB0aGlzLmNhbGVuZGFyVGltZU1vZGVsU2VydmljZS5wYWRkVG9Ud29TeW1ib2xzKHRoaXMuZGF0ZVNlcnZpY2UuZ2V0TW9udGgoZGF0ZSkpO1xuICAgIGNvbnN0IGRheSA9IHRoaXMuY2FsZW5kYXJUaW1lTW9kZWxTZXJ2aWNlLnBhZGRUb1R3b1N5bWJvbHModGhpcy5kYXRlU2VydmljZS5nZXREYXRlKGRhdGUpKTtcblxuICAgIHJldHVybiBgJHt5ZWFyfS0ke21vbnRofS0ke2RheX0gJHt2YWx1ZX1gO1xuICB9XG59XG4iXX0=